{{ define "main" }}
<section class="section container-fluid mt-n3 pb-5">
  <div class="row justify-content-center align-items-center" style="min-height: 350px;">
    <div class="col-lg-10 text-center">
      <h1 class="display-3 fw-bold mb-4">{{ .Title }}</h1>
      <p class="lead fs-4 text-muted mb-5">{{ .Params.lead | safeHTML }}</p>
      <div class="mb-5 fs-5">{{ .Content }}</div>
      <div class="d-flex flex-column flex-md-row justify-content-center gap-4">
        <a class="btn btn-primary btn-cta rounded-pill btn-lg px-5 shadow" href="{{ "blog/" | relURL }}"
          role="button">Browse posts</a>
        <a class="btn btn-outline-primary rounded-pill btn-lg px-5" href="{{ "tags/" | relURL }}" role="button">Explore
          tags</a>
      </div>
    </div>
  </div>
</section>

{{ $posts := where site.RegularPages "Section" "blog" }}
{{ $featured := where $posts "Params.pinned" true }}
{{ if eq (len $featured) 0 }}
{{ $featured = first 3 ($posts.ByDate.Reverse) }}
{{ end }}

<section class="section section-md container-fluid px-lg-5 pb-5">
  <div class="row justify-content-center">
    <div class="col-lg-11">
      <div class="d-flex align-items-center justify-content-between mb-4 border-bottom pb-3">
        <h2 class="h3 fw-bold mb-0">Featured posts</h2>
        <a class="text-decoration-none fw-bold" href="{{ "blog/" | relURL }}">View all posts →</a>
      </div>
      {{ if gt (len $featured) 0 }}
      <div class="featured-list">
        {{ range $featured }}
        <article class="featured-row d-flex align-items-center position-relative">
          <div class="featured-row__content flex-grow-1">
            <p class="text-muted small mb-2">{{ .Date.Format "Jan 2, 2006" }} · {{ .ReadingTime }} min read</p>
            <h3 class="featured-row__title h4 fw-bold mb-2">
              <a class="text-decoration-none stretched-link" href="{{ .RelPermalink }}">{{ .Title }}</a>
            </h3>
            <p class="featured-row__summary text-muted mb-0">{{ .Summary | truncate 140 }}</p>
          </div>
          {{ if .Params.images }}
          {{ $imgName := index .Params.images 0 }}
          <div class="featured-row__media">
            {{ partial "img.html" (dict "page" . "src" $imgName "class" "featured-row__img" "alt" .Title "width" 320) }}
          </div>
          {{ end }}
        </article>
        {{ end }}
      </div>
      {{ else }}
      <p class="text-muted text-center py-5 fs-5">No featured posts yet.</p>
      {{ end }}
    </div>
  </div>
</section>

<section class="section section-md container-fluid px-lg-5">
  <div class="row justify-content-center">
    <div class="col-lg-11">
      <div class="row g-5">
        <div class="col-lg-8">
          <h2 class="h3 fw-bold mb-4">Latest posts</h2>
          {{ $latest := first 6 ($posts.ByDate.Reverse) }}
          {{ if gt (len $latest) 0 }}
          <div class="d-grid gap-4">
            {{ range $latest }}
            <article class="p-4 border rounded-4 shadow-sm hover-shadow transition-all bg-body-tertiary">
              <p class="text-muted small mb-2">{{ .Date.Format "Jan 2, 2006" }} · {{ .ReadingTime }} min read</p>
              <h3 class="h4 fw-bold mb-2"><a class="text-decoration-none" href="{{ .RelPermalink }}">{{ .Title }}</a>
              </h3>
              <p class="text-muted mb-3">{{ .Summary }}</p>
              <div class="d-flex flex-wrap gap-2">
                {{ range .GetTerms "tags" }}
                <a class="badge bg-light text-dark text-decoration-none" href="{{ .RelPermalink }}">{{ .LinkTitle }}</a>
                {{ end }}
              </div>
            </article>
            {{ end }}
          </div>
          {{ else }}
          <p class="text-muted">No posts published yet.</p>
          {{ end }}
        </div>

        <div class="col-lg-4">
          <h2 class="h4 fw-bold mb-4 text-center text-lg-start">Popular tags</h2>
          <div class="d-flex flex-wrap gap-2 justify-content-center justify-content-lg-start">
            {{ range $name, $taxonomy := site.Taxonomies.tags }}
            <a class="badge bg-light text-dark fs-6 p-2 px-3 text-decoration-none"
              href="{{ $taxonomy.Page.RelPermalink }}">{{ $taxonomy.Page.Title }}</a>
            {{ end }}
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
{{ end }}

{{ define "sidebar-prefooter" }}
{{ if site.Params.doks.backgroundDots -}}
<div class="d-flex justify-content-start">
  <div class="bg-dots"></div>
</div>
{{ end -}}
{{ end }}
